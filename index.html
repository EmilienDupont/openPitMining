<!DOCTYPE html>
<meta charset="utf-8">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
                      tex2jax: {inlineMath: [['$', '$'], ['\\(','\\)']]},
                      TeX: { equationNumbers: {autoNumber: "AMS"} },
                      "HTML-CSS": { showMathMenu: false,
                                    scale: 90 }

                     });
</script>
<style>

  rect:hover {
    opacity: .8;
  }
  
  .typea {
    fill: gray;
    color: gray;
  }
  
  .typeb {
    fill: gold;
    color: gold;
  }

  .typec {
    fill: brown;
    color: brown;
  }
  
  .typed {
    fill: silver;
    color: silver;
  }

</style>
<body>
  <ul id="nav">
    <li class="current"><a href="#intro">Intro</a></li>
    <li><a href="#problem">Problem</a></li>
    <li><a href="#model">Model</a></li>
    <li><a href="#implementation">Implementation</a></li>
    <li><a href="#demo">Live Demo</a></li>
  </ul>
  <div id="container">
    <div class="section" id="intro">
      <h1>Open Pit Mining</h1>
        <subtitle>with integer programming and Gurobi</subtitle>
    </div>

    <div class="section" id="problem">
      <h2><a href="#problem" name="problem">Problem Description</a></h2>
      Problem description goes here
    </div>
    <div class="section" id="model">
      <h2><a href="#model" name="model">Mathematical Model</a></h2>

      <p>Model description goes here.</p>

    </div>
    <div class="section" id="implementation">
      <h2><a href="#implementation" name="implementation">Implementation</a></h2>
      <p>Below is the full implementation of the model (and the associated data) in
        Gurobi's Python interface:
      </p>
      <pre>
    
      </pre>
    </div>
    <div class="section" id="demo">
      <h2><a href="#demo" name="demo">Live Demo</a></h2>
      <div id="demoarea">
      </div>
      <button onclick="compute()">Mine away!</button>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script>


// Create data for each layer of blocks
var numBlocks = 18
var blocks = [];
for (var i = 0; i < numBlocks; i++) {
  blocks.push(i);
}

var layer2 = 8; var layer3 = 14; 

// Different types
var types = ["typea","typeb","typec","typed"];

// Type variable
var type = "typea";

var width = 700,
    height = 500,
    size = width/(layer2 + 2);

var svg = d3.select("#demoarea").append("svg")
    .attr("width", width)
    .attr("height", height);

// Create background
var backgroundG = svg.append("g")
    backgroundG.append("polygon").attr("points", "0,210, 0,500, 700,500, 700,210")
                                 .attr("fill", "rgb(50,50,50)")
                                 .attr("stroke", "black")
                                 .attr("stroke-width", 3);
    backgroundG.append("polygon").attr("points", "0,210, 0,0, 700,0, 700,210")
                                 .attr("fill", "rgb(6,214,255)");
    backgroundG.append("circle").attr("cx", width - 100).attr("cy", 100).attr("r", 50).attr("fill", "yellow")
                                .attr("stroke", "orange").attr("stroke-width", 5);
    
var buttonsG = svg.append("g");

var buttons = buttonsG.selectAll("circle")
                 .data(types)
                 .enter()
                 .append("circle")
                 .on("mousedown", buttonpress);

    buttons.attr("cx",  function(d,i) {
                          return (i+.5)*size/2;
                        })
           .attr("cy", 20)
           .attr("r", 15)
           .attr("class", function(d) { return d;} )
           .attr("stroke", "black")
           .attr("stroke-width", 2);

var blockRect = svg.selectAll("rect")
                   .data(blocks)
                   .enter()
                   .append("rect")
                   .on("mousedown", mousedown);
  
    blockRect.attr("x", function(d) {
              console.log(d)
              if (d >= layer2 && d < layer3) {
                return (d + 2 - layer2)*size;
              }
              else if (d >= layer3) {
                return (d + 3 - layer3)*size;
              }
              else {
                return (d+1)*size;
              }
              })
              .attr("y", function(d) {
              if (d >= layer2 && d < layer3) {
                return 4*size;
              }
              else if (d >= layer3) {
                return 5*size;
              }
              else {
                return 3*size;
              }
              })
              .attr("height", size)
              .attr("width", size)
              .attr("stroke", "black")
              .attr("stroke-width", 1)
              .attr("class", function (d) {
                        var typeinitial;
                        if (d === 0 || d === 6 || d == 9 || d == 11 || d == 16 || d == 17) {
                           typeinitial = "typeb";
                        } else {
                           typeinitial = "typea";
                        }
                        console.log(d3.select(this).attr("class") + " " + typeinitial)
                        return d3.select(this).attr("class") + " " + typeinitial;
                    });

var solutionG = svg.append("g");

// sets type of clicked rectangle
function mousedown() {
  solutionG.selectAll("circle")
           .remove();
  d3.select(this)
    .attr("class", type);
}

// Change the type
function buttonpress() {
  type = d3.select(this).attr("class")
  console.log(type)
}

// Compute
function compute() {
  var solution = [0,1,2,3,4,5,6,
                  10,11,12,13,
                  17];
  
  solutionG.selectAll("circle")
           .remove();
  
  var circleSol = solutionG.selectAll("circle")
                           .data(solution)
                           .enter()
                           .append("circle");
  
  circleSol.attr("cx", function(d) {
              if (d >= layer2 && d < layer3) {
                return (d + 2 - layer2)*size + size/2;
              }
              else if (d >= layer3) {
                return (d + 3 - layer3)*size + size/2;
              }
              else {
                return (d+1)*size + size/2;
              }
              })
              .attr("cy", function(d) {
              if (d >= layer2 && d < layer3) {
                return 4*size + size/2;
              }
              else if (d >= layer3) {
                return 5*size + size/2;
              }
              else {
                return 3*size + size/2;
              }
              })
              .attr("r", 15)
              .attr("fill", "black")
              .style("opacity", 0)
              .transition()
              .style("opacity", .5)
              .duration(500)
              .delay(function(i) { return i*100 });
}


</script>